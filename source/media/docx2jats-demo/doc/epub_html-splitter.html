<?xml version="1.0" encoding="UTF-8"?><html xmlns:p="http://www.w3.org/ns/xproc" xmlns:a="http://relaxng.org/ns/compatibility/annotations/1.0" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:rng="http://relaxng.org/ns/structure/1.0" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" type="text/css" href="transpectdoc.css" /><link rel="stylesheet" type="text/css" href="highlight/styles/default.css" /><script src="jquery.js"></script><script src="highlight/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script type="text/javascript" src="transpectdoc.js"></script><title>epub:html-splitter – transpectdoc</title></head><body><div id="transpectdoc"><div id="epub_html-splitter" class="id-container"><div id="nav" class="macroblock"><h1>docx2jats-demo</h1><ul class="nav"><li><p class="toggle level1" id="nav_frontend"><a class="fold pointer">Frontend Pipelines</a> <span class="count">(1)</span></p><ul><li><p class="nav" id="nav_docx2jats"><a href="docx2jats.html">docx2jats <span title="anonymous – this step has no type">Ⓐ</span></a></p></li></ul></li><li><p class="toggle level1" id="nav_typedSteps"><a class="fold pointer">Step Declarations</a> <span class="count">(72)</span></p><ul><li><p class="toggle level2" id="nav_namespaceSteps_css"><a class="fold pointer">css:…</a> <span class="count">(5)</span></p><ul><li><p class="nav" id="nav_css_generate"><a href="css_generate.html">css:generate</a></p></li><li><p class="toggle level3"><a class="fold pointer">css.xpl (library)</a> <span class="count">(1)</span></p><ul><li><p class="nav" id="nav_css_parse"><a href="css_parse.html">css:parse</a></p></li></ul></li><li><p class="toggle level3"><a class="fold pointer">map-style-names.xpl (library)</a> <span class="count">(3)</span></p><ul><li><p class="nav" id="nav_css_consolidate-maps"><a href="css_consolidate-maps.html">css:consolidate-maps</a></p></li><li><p class="nav" id="nav_css_apply-map"><a href="css_apply-map.html">css:apply-map</a></p></li><li><p class="nav" id="nav_css_map-styles"><a href="css_map-styles.html">css:map-styles</a></p></li></ul></li></ul></li><li><p class="toggle level2" id="nav_namespaceSteps_cx"><a class="fold pointer">cx:…</a> <span class="count">(2)</span></p><ul><li><p class="toggle level3"><a class="fold pointer">library-1.0.xpl (library)</a> <span class="count">(2)</span></p><ul><li><p class="nav" id="nav_cx_zip"><a href="cx_zip.html">cx:zip</a></p></li><li><p class="nav" id="nav_cx_message"><a href="cx_message.html">cx:message</a></p></li></ul></li></ul></li><li><p class="toggle level2" id="nav_namespaceSteps_docx2hub"><a class="fold pointer">docx2hub:…</a> <span class="count">(2)</span></p><ul><li><p class="nav" id="nav_docx2hub_convert"><a href="docx2hub_convert.html">docx2hub:convert</a></p></li><li><p class="nav" id="nav_docx2hub_single-tree"><a href="docx2hub_single-tree.html">docx2hub:single-tree</a></p></li></ul></li><li><p class="toggle level2" id="nav_namespaceSteps_epub"><a class="fold pointer">epub:…</a> <span class="count">(6)</span></p><ul><li><p class="nav" id="nav_epub_convert"><a href="epub_convert.html">epub:convert</a></p></li><li><p class="nav" id="nav_epub_create-ocf"><a href="epub_create-ocf.html">epub:create-ocf</a></p></li><li><p class="nav" id="nav_epub_create-ops"><a href="epub_create-ops.html">epub:create-ops</a></p></li><li><p class="nav" id="nav_epub_html-splitter"><a href="epub_html-splitter.html">epub:html-splitter</a></p></li><li><p class="nav" id="nav_epub_create-opf"><a href="epub_create-opf.html">epub:create-opf</a></p></li><li><p class="nav" id="nav_epub_zip-package"><a href="epub_zip-package.html">epub:zip-package</a></p></li></ul></li><li><p class="toggle level2" id="nav_namespaceSteps_hub"><a class="fold pointer">hub:…</a> <span class="count">(2)</span></p><ul><li><p class="nav" id="nav_hub_evolve-hub"><a href="hub_evolve-hub.html">hub:evolve-hub</a></p></li><li><p class="nav" id="nav_hub_evolve-hub_lists-by-indent"><a href="hub_evolve-hub_lists-by-indent.html">hub:evolve-hub_lists-by-indent</a></p></li></ul></li><li><p class="toggle level2" id="nav_namespaceSteps_jats"><a class="fold pointer">jats:…</a> <span class="count">(2)</span></p><ul><li><p class="nav" id="nav_jats_hub2bits"><a href="jats_hub2bits.html">jats:hub2bits</a></p></li><li><p class="nav" id="nav_jats_html"><a href="jats_html.html">jats:html</a></p></li></ul></li><li><p class="toggle level2" id="nav_namespaceSteps_p"><a class="fold pointer">p:…</a> <span class="count">(28)</span></p><ul><li><p class="toggle level3"><a class="fold pointer">xproc-1.0.xpl (library)</a> <span class="count">(28)</span></p><ul><li><p class="nav" id="nav_p_add-attribute"><a href="p_add-attribute.html">p:add-attribute</a></p></li><li><p class="nav" id="nav_p_add-xml-base"><a href="p_add-xml-base.html">p:add-xml-base</a></p></li><li><p class="nav" id="nav_p_delete"><a href="p_delete.html">p:delete</a></p></li><li><p class="nav" id="nav_p_directory-list"><a href="p_directory-list.html">p:directory-list</a></p></li><li><p class="nav" id="nav_p_error"><a href="p_error.html">p:error</a></p></li><li><p class="nav" id="nav_p_filter"><a href="p_filter.html">p:filter</a></p></li><li><p class="nav" id="nav_p_http-request"><a href="p_http-request.html">p:http-request</a></p></li><li><p class="nav" id="nav_p_identity"><a href="p_identity.html">p:identity</a></p></li><li><p class="nav" id="nav_p_insert"><a href="p_insert.html">p:insert</a></p></li><li><p class="nav" id="nav_p_label-elements"><a href="p_label-elements.html">p:label-elements</a></p></li><li><p class="nav" id="nav_p_load"><a href="p_load.html">p:load</a></p></li><li><p class="nav" id="nav_p_pack"><a href="p_pack.html">p:pack</a></p></li><li><p class="nav" id="nav_p_parameters"><a href="p_parameters.html">p:parameters</a></p></li><li><p class="nav" id="nav_p_rename"><a href="p_rename.html">p:rename</a></p></li><li><p class="nav" id="nav_p_set-attributes"><a href="p_set-attributes.html">p:set-attributes</a></p></li><li><p class="nav" id="nav_p_sink"><a href="p_sink.html">p:sink</a></p></li><li><p class="nav" id="nav_p_split-sequence"><a href="p_split-sequence.html">p:split-sequence</a></p></li><li><p class="nav" id="nav_p_store"><a href="p_store.html">p:store</a></p></li><li><p class="nav" id="nav_p_string-replace"><a href="p_string-replace.html">p:string-replace</a></p></li><li><p class="nav" id="nav_p_unwrap"><a href="p_unwrap.html">p:unwrap</a></p></li><li><p class="nav" id="nav_p_wrap"><a href="p_wrap.html">p:wrap</a></p></li><li><p class="nav" id="nav_p_wrap-sequence"><a href="p_wrap-sequence.html">p:wrap-sequence</a></p></li><li><p class="nav" id="nav_p_xslt"><a href="p_xslt.html">p:xslt</a></p></li><li><p class="nav" id="nav_p_exec"><a href="p_exec.html">p:exec</a></p></li><li><p class="nav" id="nav_p_hash"><a href="p_hash.html">p:hash</a></p></li><li><p class="nav" id="nav_p_uuid"><a href="p_uuid.html">p:uuid</a></p></li><li><p class="nav" id="nav_p_validate-with-relax-ng"><a href="p_validate-with-relax-ng.html">p:validate-with-relax-ng</a></p></li><li><p class="nav" id="nav_p_validate-with-schematron"><a href="p_validate-with-schematron.html">p:validate-with-schematron</a></p></li></ul></li></ul></li><li><p class="toggle level2" id="nav_namespaceSteps_tr"><a class="fold pointer">tr:…</a> <span class="count">(25)</span></p><ul><li><p class="nav" id="nav_tr_file-uri"><a href="tr_file-uri.html">tr:file-uri</a></p></li><li><p class="nav" id="nav_tr_unescape-uri"><a href="tr_unescape-uri.html">tr:unescape-uri</a></p></li><li><p class="nav" id="nav_tr_xslt-mode"><a href="tr_xslt-mode.html">tr:xslt-mode</a></p></li><li><p class="nav" id="nav_tr_store-debug"><a href="tr_store-debug.html">tr:store-debug</a></p></li><li><p class="nav" id="nav_tr_prepend-xml-model"><a href="tr_prepend-xml-model.html">tr:prepend-xml-model</a></p></li><li><p class="nav" id="nav_tr_unzip"><a href="tr_unzip.html">tr:unzip</a></p></li><li><p class="nav" id="nav_tr_paths"><a href="tr_paths.html">tr:paths</a></p></li><li><p class="nav" id="nav_tr_dynamic-transformation-pipeline"><a href="tr_dynamic-transformation-pipeline.html">tr:dynamic-transformation-pipeline</a></p></li><li><p class="nav" id="nav_tr_remove-ns-decl-and-xml-base"><a href="tr_remove-ns-decl-and-xml-base.html">tr:remove-ns-decl-and-xml-base</a></p></li><li><p class="nav" id="nav_tr_check-styles"><a href="tr_check-styles.html">tr:check-styles</a></p></li><li><p class="nav" id="nav_tr_patch-svrl"><a href="tr_patch-svrl.html">tr:patch-svrl</a></p></li><li><p class="nav" id="nav_tr_html-embed-resources"><a href="tr_html-embed-resources.html">tr:html-embed-resources</a></p></li><li><p class="nav" id="nav_tr_oxy-validate-with-schematron"><a href="tr_oxy-validate-with-schematron.html">tr:oxy-validate-with-schematron</a></p></li><li><p class="nav" id="nav_tr_validate-with-rng"><a href="tr_validate-with-rng.html">tr:validate-with-rng</a></p></li><li><p class="nav" id="nav_tr_errorPI2svrl"><a href="tr_errorPI2svrl.html">tr:errorPI2svrl</a></p></li><li><p class="nav" id="nav_tr_validate-with-rng-PI"><a href="tr_validate-with-rng-PI.html">tr:validate-with-rng-PI</a></p></li><li><p class="nav" id="nav_tr_epubcheck-idpf"><a href="tr_epubcheck-idpf.html">tr:epubcheck-idpf</a></p></li><li><p class="toggle level3"><a class="fold pointer">load-cascaded.xpl (library)</a> <span class="count">(2)</span></p><ul><li><p class="nav" id="nav_tr_load-cascaded"><a href="tr_load-cascaded.html">tr:load-cascaded</a></p></li><li><p class="nav" id="nav_tr_load-whole-cascade"><a href="tr_load-whole-cascade.html">tr:load-whole-cascade</a></p></li></ul></li><li><p class="toggle level3"><a class="fold pointer">prepend-hub-xml-model.xpl (library)</a> <span class="count">(1)</span></p><ul><li><p class="nav" id="nav_tr_prepend-hub-xml-model"><a href="tr_prepend-hub-xml-model.html">tr:prepend-hub-xml-model</a></p></li></ul></li><li><p class="toggle level3"><a class="fold pointer">simple-progress-msg.xpl (library)</a> <span class="count">(2)</span></p><ul><li><p class="nav" id="nav_tr_simple-progress-msg"><a href="tr_simple-progress-msg.html">tr:simple-progress-msg</a></p></li><li><p class="nav" id="nav_tr_propagate-caught-error"><a href="tr_propagate-caught-error.html">tr:propagate-caught-error</a></p></li></ul></li><li><p class="toggle level3"><a class="fold pointer">transpect-lib.xpl (library)</a> <span class="count">(1)</span></p><ul><li><p class="nav" id="nav_tr_image-identify"><a href="tr_image-identify.html">tr:image-identify</a></p></li></ul></li><li><p class="toggle level3"><a class="fold pointer">validate-with-schematron.xpl (library)</a> <span class="count">(2)</span></p><ul><li><p class="nav" id="nav_tr_validate-with-schematron"><a href="tr_validate-with-schematron.html">tr:validate-with-schematron</a></p></li><li><p class="nav" id="nav_tr_validate-with-schematron2"><a href="tr_validate-with-schematron2.html">tr:validate-with-schematron2</a></p></li></ul></li></ul></li></ul></li><li><p class="toggle level1"><a class="fold pointer">Dynamic Evaluation Candidates</a> <span class="count">(1)</span></p><ul><li><p class="nav" id="nav_evolve-hubfallback"><a href="evolve-hubfallback.html">evolve-hub/fallback <span title="anonymous – this step has no type">Ⓐ</span><span title="dynamic – this is an example for a dynamically loaded or generated pipeline">Ⓓ</span></a></p></li></ul></li></ul></div><div id="main" class="macroblock"><h2>epub:html-splitter <span class="name" id="step_html-splitter">html-splitter</span></h2><div class="file-path block"><p class="file-path">epubtools/modules/html-splitter/xpl/html-splitter.xpl</p><p class="file-path"> Import URI: ../../html-splitter/xpl/html-splitter.xpl</p></div><div class="documentation block">
    <p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">Sample invocation (for debugging purposes):</p>
    <pre xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">calabash/calabash.sh 
    -i source=file:/$(cygpath -ma ../content/output/debug/epubtools/create-ops/pre-split.html) 
    -i conf=file:/$(cygpath -ma adaptions/publisher/series/epubtools/heading-conf.xml) 
    -o result=tmp.html -o report=report.xml -o files=files.xml  
    file:/$(cygpath -ma epubtools/modules/html-splitter/xpl/html-splitter.xpl) 
    base-uri=file:/$(cygpath -ma ../content/output/debug/epubtools/create-ops/pre-split.html)
    debug=yes
    debug-dir-uri=file:/$(cygpath -ma ../content/output/debug)</pre>
    <p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">Calabash seems to suppress some XSLT errors, for instance when a stylesheet is looping. Therefore it might be
      necessary to replace collection()[…] with document(…) in the XSL (alternative variable declarations are already
      included in the xsl file, commented out) and run saxon from the command line, for example like this:</p>
    <pre xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">PRE_SPLIT=file:/$(cygpath -ma ../content/le-tex/whitepaper/de/output/output/debug/epubtools/create-ops/pre-split.html)
saxon -xsl:epubtools/modules/html-splitter/xsl/html-splitter.xsl -s:$PRE_SPLIT -it:main \
    debug-dir-uri=file:/$(cygpath -ma debug) \
    debug=yes \
    final-pub-type=EPUB2 \
    heading-conf-uri=file:/$(cygpath -ma adaptions/common/epubtools/heading-conf.xml) \
    meta-uri=file:/$(cygpath -ma ../content/le-tex/whitepaper/de/output/output/debug/epubtools/epub-config.xml) \
    datadir=file:/$(cygpath -ma debug/datadir)</pre>
  </div><!--Something went wrong: no SVG representation available.--><div class="interface block input"><h3 class="toggle"><a class="pointer">Input Ports</a></h3><table><colgroup><col class="name" /><col class="doc" /><col class="connect" /></colgroup><tr><th>Name</th><th>Documentation</th><th>Connections</th></tr><tr><td><p class="port-declaration"><span class="name">source</span><span class="flag primary" title="Primary port">Ⓟ</span></p></td><td></td><td><ul class="connections"><li><a href="file:/C:/cygwin/home/gerrit/XML/Prague/2016/transpect-tutorial/docx2jats-demo/doc/epub_create-ops.html#step_d254e836">epub:create-ops/tr:store-debug <span class="name">d254e836</span> result</a></li></ul></td></tr><tr><td><p class="port-declaration"><span class="name">conf</span><span class="flag sequence" title="Accepts a sequence of documents">Ⓢ</span></p></td><td><div class="documentation"><p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">/hierarchy – may be included in /epub-config</p></div></td><td><ul class="connections"><li><a href="file:/C:/cygwin/home/gerrit/XML/Prague/2016/transpect-tutorial/docx2jats-demo/doc/epub_create-ops.html">epub:create-ops/c:file <span class="name">create-ops</span> conf</a></li></ul></td></tr><tr><td><p class="port-declaration"><span class="name">meta</span></p></td><td><div class="documentation"><p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">/epub-config</p></div></td><td><ul class="connections"><li><a href="file:/C:/cygwin/home/gerrit/XML/Prague/2016/transpect-tutorial/docx2jats-demo/doc/epub_create-ops.html#step_copy-resources">epub:create-ops/p:group <span class="name">copy-resources</span> meta-with-uri-resolved-cover-href</a></li></ul></td></tr><tr><td><p class="port-declaration"><span class="name">css-xml</span></p></td><td><div class="documentation"><p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">XML representation of the parsed CSS</p></div></td><td><ul class="connections"><li><a href="file:/C:/cygwin/home/gerrit/XML/Prague/2016/transpect-tutorial/docx2jats-demo/doc/epub_create-ops.html#step_copy-resources">epub:create-ops/p:group <span class="name">copy-resources</span> css-xml</a></li></ul></td></tr></table></div><div class="interface block output"><h3 class="toggle"><a class="pointer">Output Ports</a></h3><table><colgroup><col class="name" /><col class="doc" /><col class="connect" /></colgroup><tr><th>Name</th><th>Documentation</th><th>Connections</th></tr><tr><td><p class="port-declaration"><span class="name">result</span><span class="flag primary" title="Primary port">Ⓟ</span></p></td><td></td><td>
    
  </td></tr><tr><td><p class="port-declaration"><span class="name">files</span></p></td><td></td><td>
    
  </td></tr><tr><td><p class="port-declaration"><span class="name">report</span></p></td><td></td><td>
    
  </td></tr><tr><td><p class="port-declaration"><span class="name">unused-css-resources</span><span class="flag sequence" title="Accepts a sequence of documents">Ⓢ</span></p></td><td></td><td>
    
  </td></tr><tr><td><p class="port-declaration"><span class="name">splitting-report</span><span class="flag sequence" title="Accepts a sequence of documents">Ⓢ</span></p></td><td></td><td>
    
  </td></tr></table></div><div class="interface block option"><h3 class="toggle"><a class="pointer">Options</a></h3><table><colgroup><col class="name" /><col class="doc" /><col class="connect" /></colgroup><tr><th>Name</th><th>Documentation</th><th>Default</th></tr><tr><td><p class="option" id="option_base-uri"><span class="name">base-uri</span><span class="flag required" title="Required">Ⓡ</span></p></td><td></td><td><p></p></td></tr><tr><td><p class="option" id="option_target"><span class="name">target</span></p></td><td></td><td><p><span class="default">'EPUB2'</span></p></td></tr><tr><td><p class="option" id="option_debug"><span class="name">debug</span></p></td><td></td><td><p><span class="default">'no'</span></p></td></tr><tr><td><p class="option" id="option_debug-dir-uri"><span class="name">debug-dir-uri</span></p></td><td></td><td><p><span class="default">'debug'</span></p></td></tr></table></div><div class="subpipeline block"><h3 class="toggle"><a class="pointer">Subpipeline</a></h3><table><colgroup><col /><col /><col /><col /><col /><col class="name" /><col class="inputs" /><col class="outputs" /><col class="options" /></colgroup><tr><th colspan="6">Step</th><th>Inputs</th><th>Outputs</th><th>Options</th></tr><tr><td colspan="6"><p class="names"><span class="type">p:variable</span> <span class="name" id="var_css-handling">css-handling</span></p></td><td><p><a href="#step_html-splitter_port_meta">meta</a> on <a href="#step_html-splitter">html-splitter</a></p></td><td></td><td>(/epub-config/@css-handling, 'regenerated-per-split')[1]</td></tr><tr><td colspan="6"><p class="names"><span class="type">p:variable</span> <span class="name" id="var_html-subdir-name">html-subdir-name</span></p></td><td><p><a href="#step_html-splitter_port_meta">meta</a> on <a href="#step_html-splitter">html-splitter</a></p></td><td></td><td>(/epub-config/@html-subdir-name, '')[1]</td></tr><tr><td colspan="6"><p class="names"><span class="type"><a href="p_identity.html">p:identity</a></span> <span class="name" id="step_strip-leading-non-elements">strip-leading-non-elements</span></p><p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">Strip spurious text-only document nodes that sometimes occured before the HTML
      document.</p></td><td><dl><dt>source</dt><dd>
      <p><a href="#step_html-splitter_port_source">source</a> on <a href="#step_html-splitter">html-splitter</a></p>
    </dd></dl></td><td><p id="step_strip-leading-non-elements_port_result">result</p></td><td></td></tr><tr class="try"><td rowspan="83"><p class="rotate" title="p:try">p:try <span class="name" id="step_html-splitter-group">html-splitter-group</span></p></td><td colspan="5"><p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">You might need to comment out this p:try/p:catch and move name="html-splitter-group" to the
      followin p:group in order to facilitate debugging if there is an error in the splitter XSLT. In extreme cases, it
      might be necessary to invoke the XSLT directly. For instructions, see the comments after the xsl:param
      instructions in html-splitter.xsl.</p></td><td></td><td></td><td></td></tr><tr class="group"><td rowspan="75"><p class="rotate" title="p:group">p:group <span class="name generated" id="step_d256e84">d256e84</span></p></td><td colspan="4"></td><td></td><td></td><td></td></tr><tr><td colspan="4"><p class="names"><span class="type">p:variable</span> <span class="name" id="var_workdir">workdir</span></p></td><td><p><a href="#step_strip-leading-non-elements_port_result">result</a> on <a href="#step_strip-leading-non-elements">strip-leading-non-elements</a></p></td><td></td><td>replace($base-uri, '^(.*[/])+(.*)', '$1')</td></tr><tr><td colspan="4"><p class="names"><span class="type">p:variable</span> <span class="name" id="var_basename">basename</span></p></td><td><p><a href="#step_strip-leading-non-elements_port_result">result</a> on <a href="#step_strip-leading-non-elements">strip-leading-non-elements</a></p></td><td></td><td>replace($base-uri, '^(.*[/])+(.*?)(\.[\w.]+)$', '$2')</td></tr><tr><td colspan="4"><p class="names"><span class="type">p:variable</span> <span class="name" id="var_indent">indent</span></p></td><td><p><a href="#step_html-splitter_port_meta">meta</a> on <a href="#step_html-splitter">html-splitter</a></p></td><td></td><td>(/epub-config/@indent, 'true')[1]</td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="tr_store-debug.html">tr:store-debug</a></span> <span class="name generated" id="step_d256e130">d256e130</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_strip-leading-non-elements_port_result">result</a> on <a href="#step_strip-leading-non-elements">strip-leading-non-elements</a></p></dd></dl></td><td><p id="step_d256e130_port_result">result</p></td><td><p><a href="tr_store-debug.html#option_pipeline-step">pipeline-step</a> = concat('epubtools/html-splitter/', $basename, '/splitter-input')</p><p><a href="tr_store-debug.html#option_active">active</a> = $debug</p><p><a href="tr_store-debug.html#option_base-uri">base-uri</a> = $debug-dir-uri</p></td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="p_xslt.html">p:xslt</a></span> <span class="name" id="step_split">split</span></p></td><td><dl><dt>source</dt><dd>
          <p><a href="#step_strip-leading-non-elements_port_result">result</a> on <a href="#step_strip-leading-non-elements">strip-leading-non-elements</a></p>
          <p><a href="#step_html-splitter_port_conf">conf</a> on <a href="#step_html-splitter">html-splitter</a></p>
          <p><a href="#step_html-splitter_port_meta">meta</a> on <a href="#step_html-splitter">html-splitter</a></p>
        </dd><dt>stylesheet</dt><dd>
          <p>p:document<a href="../xsl/html-splitter.xsl">../xsl/html-splitter.xsl</a></p>
        </dd></dl></td><td><p id="step_split_port_result">result</p></td><td><p><a href="p_xslt.html#option_template-name">template-name</a> = 'main'</p></td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="tr_store-debug.html">tr:store-debug</a></span> <span class="name generated" id="step_d256e171">d256e171</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_split_port_result">result</a> on <a href="#step_split">split</a></p></dd></dl></td><td><p id="step_d256e171_port_result">result</p></td><td><p><a href="tr_store-debug.html#option_pipeline-step">pipeline-step</a> = concat('epubtools/html-splitter/', $basename, '/chunks')</p><p><a href="tr_store-debug.html#option_active">active</a> = $debug</p><p><a href="tr_store-debug.html#option_base-uri">base-uri</a> = $debug-dir-uri</p></td></tr><tr class="foreach"><td rowspan="2"><p class="rotate" title="p:for-each">p:for-each <span class="name" id="step_store-debug-try">store-debug-try</span></p></td><td colspan="3"></td><td id="step_store-debug-try_port_current">
          <p><a href="#step_split_port_secondary">secondary</a> on <a href="#step_split">split</a></p>
        </td><td></td><td></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_store.html">p:store</a></span> <span class="name generated" id="step_d256e188">d256e188</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_store-debug-try_port_current">current</a> on <a href="#step_store-debug-try">store-debug-try</a></p></dd></dl></td><td><p id="step_d256e188_port_result">result</p></td><td><p><a href="p_store.html#option_href">href</a> = base-uri()</p></td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="p_identity.html">p:identity</a></span> <span class="name" id="step_splitting-report">splitting-report</span></p></td><td><dl><dt>source</dt><dd>
          <p><a href="#step_split_port_secondary">secondary</a> on <a href="#step_split">split</a></p>
        </dd></dl></td><td><p id="step_splitting-report_port_result">result</p></td><td></td></tr><tr class="local-end"><td colspan="4"><p class="names"><span class="type"><a href="p_sink.html">p:sink</a></span> <span class="name generated" id="step_d256e202">d256e202</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_splitting-report_port_result">result</a> on <a href="#step_splitting-report">splitting-report</a></p></dd></dl></td><td></td><td></td></tr><tr class="cases"><td rowspan="22"><p class="rotate" title="p:choose">p:choose <span class="name" id="step_per-split-css">per-split-css</span></p></td><td colspan="3"></td><td></td><td></td><td></td></tr><tr class="odd cond"><td rowspan="15"><p class="rotate" title="contains($css-handling, 'regenerated-per-split')">contains($css-handling, 'regenerated-per-split')</p></td><td colspan="2"></td><td></td><td></td><td></td></tr><tr><td colspan="2"><p class="names"><span class="type"><a href="p_xslt.html">p:xslt</a></span> <span class="name" id="step_per-split-css-xml-representations">per-split-css-xml-representations</span></p><p xmlns:cx="http://xmlcalabash.com/ns/extensions" xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">Primary output: the new, reduced common CSS. Secondary port: individual CSS files if
              applicable. Also on secondary port: A file named 'unused-css-resources.xml'</p></td><td><dl><dt>parameters</dt><dd>
              <p>p:empty</p>
            </dd><dt>stylesheet</dt><dd>
              <p>p:document<a href="../xsl/per-split-css.xsl">../xsl/per-split-css.xsl</a></p>
            </dd><dt>source</dt><dd>
              <p><a href="#step_html-splitter_port_css-xml">css-xml</a> on <a href="#step_html-splitter">html-splitter</a></p>
              <p><a href="#step_split_port_secondary">secondary</a> on <a href="#step_split">split</a></p>
            </dd></dl></td><td><p id="step_per-split-css-xml-representations_port_result">result</p></td><td></td></tr><tr class="local-end"><td colspan="2"><p class="names"><span class="type"><a href="p_sink.html">p:sink</a></span> <span class="name generated" id="step_d256e259">d256e259</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_per-split-css-xml-representations_port_result">result</a> on <a href="#step_per-split-css-xml-representations">per-split-css-xml-representations</a></p></dd></dl></td><td></td><td></td></tr><tr><td colspan="2"><p class="names"><span class="type"><a href="p_identity.html">p:identity</a></span> <span class="name" id="step_unused-css-resources">unused-css-resources</span></p></td><td><dl><dt>source</dt><dd>
              <p><a href="#step_per-split-css-xml-representations_port_secondary">secondary</a> on <a href="#step_per-split-css-xml-representations">per-split-css-xml-representations</a></p>
            </dd></dl></td><td><p id="step_unused-css-resources_port_result">result</p></td><td></td></tr><tr><td colspan="2"><p class="names"><span class="type"><a href="tr_store-debug.html">tr:store-debug</a></span> <span class="name generated" id="step_d256e270">d256e270</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_unused-css-resources_port_result">result</a> on <a href="#step_unused-css-resources">unused-css-resources</a></p></dd></dl></td><td><p id="step_d256e270_port_result">result</p></td><td><p><a href="tr_store-debug.html#option_pipeline-step">pipeline-step</a> = concat('epubtools/html-splitter/', $basename, '/unused-css-resources')</p><p><a href="tr_store-debug.html#option_active">active</a> = $debug</p><p><a href="tr_store-debug.html#option_base-uri">base-uri</a> = $debug-dir-uri</p></td></tr><tr class="local-end"><td colspan="2"><p class="names"><span class="type"><a href="p_sink.html">p:sink</a></span> <span class="name generated" id="step_d256e279">d256e279</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e270_port_result">result</a> on <a href="#step_d256e270">d256e270</a></p></dd></dl></td><td></td><td></td></tr><tr><td colspan="2"><p class="names"><span class="type"><a href="p_identity.html">p:identity</a></span> <span class="name" id="step_individual-css-representations">individual-css-representations</span></p></td><td><dl><dt>source</dt><dd>
              <p><a href="#step_per-split-css-xml-representations_port_secondary">secondary</a> on <a href="#step_per-split-css-xml-representations">per-split-css-xml-representations</a></p>
            </dd></dl></td><td><p id="step_individual-css-representations_port_result">result</p></td><td></td></tr><tr class="local-end"><td colspan="2"><p class="names"><span class="type"><a href="p_sink.html">p:sink</a></span> <span class="name generated" id="step_d256e289">d256e289</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_individual-css-representations_port_result">result</a> on <a href="#step_individual-css-representations">individual-css-representations</a></p></dd></dl></td><td></td><td></td></tr><tr><td colspan="2"><p class="names"><span class="type"><a href="p_xslt.html">p:xslt</a></span> <span class="name" id="step_insert-individual-css-link">insert-individual-css-link</span></p><p xmlns:cx="http://xmlcalabash.com/ns/extensions" xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">Will insert links for per-split css. Has side effect: svg namespace
              fixup.</p></td><td><dl><dt>parameters</dt><dd>
              <p>p:empty</p>
            </dd><dt>stylesheet</dt><dd>
              <p>p:document<a href="../xsl/insert-individual-css-link.xsl">../xsl/insert-individual-css-link.xsl</a></p>
            </dd><dt>source</dt><dd>
              <p><a href="#step_split_port_secondary">secondary</a> on <a href="#step_split">split</a></p>
              <p><a href="#step_individual-css-representations_port_result">result</a> on <a href="#step_individual-css-representations">individual-css-representations</a></p>
            </dd></dl></td><td><p id="step_insert-individual-css-link_port_result">result</p></td><td><p><a href="p_xslt.html#option_template-name">template-name</a> = 'main'</p></td></tr><tr class="foreach"><td rowspan="2"><p class="rotate" title="p:for-each">p:for-each <span class="name generated" id="step_d256e319">d256e319</span></p></td><td colspan="1"></td><td id="step_d256e319_port_current">
              <p><a href="#step_insert-individual-css-link_port_result">result</a> on <a href="#step_insert-individual-css-link">insert-individual-css-link</a></p>
              <p><a href="#step_insert-individual-css-link_port_secondary">secondary</a> on <a href="#step_insert-individual-css-link">insert-individual-css-link</a></p>
            </td><td></td><td></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="tr_store-debug.html">tr:store-debug</a></span> <span class="name generated" id="step_d256e328">d256e328</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e319_port_current">current</a> on <a href="#step_d256e319">d256e319</a></p></dd></dl></td><td><p id="step_d256e328_port_result">result</p></td><td><p><a href="tr_store-debug.html#option_pipeline-step">pipeline-step</a> = concat('epubtools/html-splitter/', $basename, '/individual-css-links/', replace(base-uri(), '^.+/', ''))</p><p><a href="tr_store-debug.html#option_active">active</a> = $debug</p><p><a href="tr_store-debug.html#option_base-uri">base-uri</a> = $debug-dir-uri</p></td></tr><tr class="foreach"><td rowspan="3"><p class="rotate" title="p:for-each">p:for-each <span class="name" id="step_generate-css">generate-css</span></p></td><td colspan="1"></td><td id="step_generate-css_port_current">
              <p><a href="#step_per-split-css-xml-representations_port_result">result</a> on <a href="#step_per-split-css-xml-representations">per-split-css-xml-representations</a></p>
              <p><a href="#step_individual-css-representations_port_result">result</a> on <a href="#step_individual-css-representations">individual-css-representations</a></p>
            </td><td></td><td></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="css_generate.html">css:generate</a></span> <span class="name" id="step_gen">gen</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_generate-css_port_current">current</a> on <a href="#step_generate-css">generate-css</a></p></dd></dl></td><td><p id="step_gen_port_result">result</p></td><td><p><a href="css_generate.html#option_prepend-resource-path">prepend-resource-path</a> = '../'</p><p><a href="css_generate.html#option_strip-comments">strip-comments</a> = if (contains($css-handling, 'remove-comments'))                         then 'true' else 'false'</p></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="tr_store-debug.html">tr:store-debug</a></span> <span class="name generated" id="step_d256e355">d256e355</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_gen_port_result">result</a> on <a href="#step_gen">gen</a></p></dd></dl></td><td><p id="step_d256e355_port_result">result</p></td><td><p><a href="tr_store-debug.html#option_pipeline-step">pipeline-step</a> = concat('epubtools/html-splitter/', $basename, '/per-split-css/', replace(base-uri(), '^.+/', ''))</p><p><a href="tr_store-debug.html#option_active">active</a> = $debug</p><p><a href="tr_store-debug.html#option_base-uri">base-uri</a> = $debug-dir-uri</p></td></tr><tr class="local-end"><td colspan="2"><p class="names"><span class="type"><a href="p_sink.html">p:sink</a></span> <span class="name generated" id="step_d256e365">d256e365</span></p></td><td><dl><dt>source</dt><dd></dd></dl></td><td></td><td></td></tr><tr class="even cond"><td rowspan="2"><p class="rotate" title="$css-handling = 'unchanged'">$css-handling = 'unchanged'</p></td><td colspan="2"></td><td></td><td></td><td></td></tr><tr><td colspan="2"><p class="names"><span class="type"><a href="p_identity.html">p:identity</a></span> <span class="name generated" id="step_d256e377">d256e377</span></p></td><td><dl><dt>source</dt><dd>
              <p><a href="#step_split_port_secondary">secondary</a> on <a href="#step_split">split</a></p>
            </dd></dl></td><td><p id="step_d256e377_port_result">result</p></td><td></td></tr><tr class="odd cond"><td rowspan="4"><p class="rotate" title="p:otherwise">p:otherwise</p></td><td colspan="2"><p xmlns:cx="http://xmlcalabash.com/ns/extensions" xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">regenerated</p></td><td></td><td></td><td></td></tr><tr><td colspan="2"><p class="names"><span class="type"><a href="css_generate.html">css:generate</a></span> <span class="name" id="step_gen">gen</span></p></td><td><dl><dt>source</dt><dd>
              <p><a href="#step_html-splitter_port_css-xml">css-xml</a> on <a href="#step_html-splitter">html-splitter</a></p>
            </dd></dl></td><td><p id="step_gen_port_result">result</p></td><td><p><a href="css_generate.html#option_prepend-resource-path">prepend-resource-path</a> = '../'</p></td></tr><tr class="local-end"><td colspan="2"><p class="names"><span class="type"><a href="p_sink.html">p:sink</a></span> <span class="name generated" id="step_d256e406">d256e406</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_gen_port_result">result</a> on <a href="#step_gen">gen</a></p></dd></dl></td><td></td><td></td></tr><tr><td colspan="2"><p class="names"><span class="type"><a href="p_identity.html">p:identity</a></span> <span class="name generated" id="step_d256e409">d256e409</span></p></td><td><dl><dt>source</dt><dd>
              <p><a href="#step_split_port_secondary">secondary</a> on <a href="#step_split">split</a></p>
              <p><a href="#step_gen_port_result">result</a> on <a href="#step_gen">gen</a></p>
            </dd></dl></td><td><p id="step_d256e409_port_result">result</p></td><td></td></tr><tr class="foreach"><td rowspan="28"><p class="rotate" title="p:for-each">p:for-each <span class="name" id="step_store-chunks">store-chunks</span></p></td><td colspan="3"></td><td id="step_store-chunks_port_current">
          <p><a href="#step_per-split-css_port_result">result</a> on <a href="#step_per-split-css">per-split-css</a></p>
        </td><td></td><td></td></tr><tr><td colspan="3"><p class="names"><span class="type">p:variable</span> <span class="name" id="var_chunk-file-uri">chunk-file-uri</span></p><p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">base-uri(/*) instead of base-uri() because we set the base uri of the primary CSS by adding
            an xml:base attribute.</p></td><td></td><td></td><td>replace(base-uri(/*), 'chunks/', 'epub/OEBPS/')</td></tr><tr class="cases"><td rowspan="5"><p class="rotate" title="p:choose">p:choose <span class="name generated" id="step_d256e446">d256e446</span></p></td><td colspan="2"></td><td></td><td></td><td></td></tr><tr class="odd cond"><td rowspan="2"><p class="rotate" title="$target = 'EPUB3' and matches(base-uri(), 'nav\.xhtml$') and (normalize-space($html-subdir-name))">$target = 'EPUB3' and matches(base-uri(), 'nav\.xhtml$') and (normalize-space($html-subdir-name))</p></td><td colspan="1"><p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">Brute force link correction for the generated landmarks nav that will be stored to OEBPS
              even when the remainder of the HTML is stored to a subdir.</p></td><td></td><td></td><td></td></tr><tr class="viewport"><td rowspan="1"><p class="rotate" title="p:viewport">p:viewport <span class="name generated" id="step_d256e453">d256e453</span></p></td><td colspan="0"></td><td></td><td></td><td></td></tr><tr class="even cond"><td rowspan="2"><p class="rotate" title="p:otherwise">p:otherwise</p></td><td colspan="1"></td><td></td><td></td><td></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="p_identity.html">p:identity</a></span> <span class="name generated" id="step_d256e464">d256e464</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_html-splitter_port_source">source</a> on <a href="#step_html-splitter">html-splitter</a></p></dd></dl></td><td><p id="step_d256e464_port_result">result</p></td><td></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_identity.html">p:identity</a></span> <span class="name" id="step_postprocessing">postprocessing</span></p></td><td><dl><dt>source</dt><dd></dd></dl></td><td><p id="step_postprocessing_port_result">result</p></td><td></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_delete.html">p:delete</a></span> <span class="name generated" id="step_d256e471">d256e471</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_postprocessing_port_result">result</a> on <a href="#step_postprocessing">postprocessing</a></p></dd></dl></td><td><p id="step_d256e471_port_result">result</p></td><td><p><a href="p_delete.html#option_match">match</a> = '@srcpath | @source-dir-uri'</p></td></tr><tr class="cases"><td rowspan="16"><p class="rotate" title="p:choose">p:choose <span class="name generated" id="step_d256e473">d256e473</span></p></td><td colspan="2"></td><td></td><td></td><td></td></tr><tr class="odd cond"><td rowspan="2"><p class="rotate" title="matches($chunk-file-uri, '\.ncx$' )">matches($chunk-file-uri, '\.ncx$' )</p></td><td colspan="1"></td><td></td><td></td><td></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="p_store.html">p:store</a></span> <span class="name" id="step_store-chunk">store-chunk</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e471_port_result">result</a> on <a href="#step_d256e471">d256e471</a></p></dd></dl></td><td><p id="step_store-chunk_port_result">result</p></td><td><p><a href="p_store.html#option_include-content-type">include-content-type</a> = 'true'</p><p><a href="p_store.html#option_omit-xml-declaration">omit-xml-declaration</a> = 'false'</p><p><a href="p_store.html#option_indent">indent</a> = 'true'</p><p><a href="p_store.html#option_href">href</a> = $chunk-file-uri</p><p><a href="p_store.html#option_doctype-public">doctype-public</a> = if($target eq 'EPUB3')                            then ''                            else '-//NISO//DTD ncx 2005-1//EN'</p><p><a href="p_store.html#option_doctype-system">doctype-system</a> = if($target eq 'EPUB3')                            then ''                            else 'http://www.daisy.org/z3986/2005/ncx-2005-1.dtd'</p></td></tr><tr class="even cond"><td rowspan="2"><p class="rotate" title="matches($chunk-file-uri, '\.(txt|css)$')">matches($chunk-file-uri, '\.(txt|css)$')</p></td><td colspan="1"></td><td></td><td></td><td></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="p_store.html">p:store</a></span> <span class="name generated" id="step_d256e493">d256e493</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e471_port_result">result</a> on <a href="#step_d256e471">d256e471</a></p></dd></dl></td><td><p id="step_d256e493_port_result">result</p></td><td><p><a href="p_store.html#option_method">method</a> = 'text'</p><p><a href="p_store.html#option_encoding">encoding</a> = 'UTF-8'</p><p><a href="p_store.html#option_href">href</a> = $chunk-file-uri</p></td></tr><tr class="odd cond"><td rowspan="2"><p class="rotate" title="$target = 'EPUB3' and matches(base-uri(), 'nav\.xhtml$') and (normalize-space($html-subdir-name))">$target = 'EPUB3' and matches(base-uri(), 'nav\.xhtml$') and (normalize-space($html-subdir-name))</p></td><td colspan="1"></td><td></td><td></td><td></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="p_store.html">p:store</a></span> <span class="name" id="step_store-chunk">store-chunk</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e471_port_result">result</a> on <a href="#step_d256e471">d256e471</a></p></dd></dl></td><td><p id="step_store-chunk_port_result">result</p></td><td><p><a href="p_store.html#option_include-content-type">include-content-type</a> = 'false'</p><p><a href="p_store.html#option_omit-xml-declaration">omit-xml-declaration</a> = 'false'</p><p><a href="p_store.html#option_method">method</a> = 'xhtml'</p><p><a href="p_store.html#option_indent">indent</a> = if ($indent = 'true') then 'true' else 'false'</p><p><a href="p_store.html#option_href">href</a> = $chunk-file-uri</p></td></tr><tr class="even cond"><td rowspan="3"><p class="rotate" title="$target eq 'EPUB3'">$target eq 'EPUB3'</p></td><td colspan="1"></td><td></td><td></td><td></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="p_delete.html">p:delete</a></span> <span class="name generated" id="step_d256e514">d256e514</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e471_port_result">result</a> on <a href="#step_d256e471">d256e471</a></p></dd></dl></td><td><p id="step_d256e514_port_result">result</p></td><td><p><a href="p_delete.html#option_match">match</a> = 'html:meta[@name = 'sequence']'</p></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="p_store.html">p:store</a></span> <span class="name" id="step_store-chunk">store-chunk</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e514_port_result">result</a> on <a href="#step_d256e514">d256e514</a></p></dd></dl></td><td><p id="step_store-chunk_port_result">result</p></td><td><p><a href="p_store.html#option_include-content-type">include-content-type</a> = 'false'</p><p><a href="p_store.html#option_omit-xml-declaration">omit-xml-declaration</a> = 'false'</p><p><a href="p_store.html#option_method">method</a> = 'xhtml'</p><p><a href="p_store.html#option_indent">indent</a> = if ($indent = 'true') then 'true' else 'false'</p><p><a href="p_store.html#option_href">href</a> = $chunk-file-uri</p></td></tr><tr class="odd cond"><td rowspan="2"><p class="rotate" title="$target = ('EPUB2', 'KF8') and matches(base-uri(), 'nav\.xhtml$')">$target = ('EPUB2', 'KF8') and matches(base-uri(), 'nav\.xhtml$')</p></td><td colspan="1"><p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">drop nav.xhtml for EPUB2</p></td><td></td><td></td><td></td></tr><tr class="local-end"><td colspan="1"><p class="names"><span class="type"><a href="p_sink.html">p:sink</a></span> <span class="name generated" id="step_d256e529">d256e529</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e471_port_result">result</a> on <a href="#step_d256e471">d256e471</a></p></dd></dl></td><td></td><td></td></tr><tr class="even cond"><td rowspan="4"><p class="rotate" title="p:otherwise">p:otherwise</p></td><td colspan="1"></td><td></td><td></td><td></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="p_delete.html">p:delete</a></span> <span class="name generated" id="step_d256e536">d256e536</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e471_port_result">result</a> on <a href="#step_d256e471">d256e471</a></p></dd></dl></td><td><p id="step_d256e536_port_result">result</p></td><td><p><a href="p_delete.html#option_match">match</a> = 'html:meta[@name = 'sequence'] | @epub:type | html:nav[@epub:type = 'landmarks']'</p></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="p_rename.html">p:rename</a></span> <span class="name generated" id="step_d256e538">d256e538</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e536_port_result">result</a> on <a href="#step_d256e536">d256e536</a></p></dd></dl></td><td><p id="step_d256e538_port_result">result</p></td><td><p><a href="p_rename.html#option_match">match</a> = 'html:nav'</p><p><a href="p_rename.html#option_new-name">new-name</a> = 'div'</p><p><a href="p_rename.html#option_new-namespace">new-namespace</a> = 'http://www.w3.org/1999/xhtml'</p></td></tr><tr><td colspan="1"><p class="names"><span class="type"><a href="p_store.html">p:store</a></span> <span class="name" id="step_store-chunk">store-chunk</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e538_port_result">result</a> on <a href="#step_d256e538">d256e538</a></p></dd></dl></td><td><p id="step_store-chunk_port_result">result</p></td><td><p><a href="p_store.html#option_include-content-type">include-content-type</a> = 'true'</p><p><a href="p_store.html#option_omit-xml-declaration">omit-xml-declaration</a> = 'false'</p><p><a href="p_store.html#option_method">method</a> = 'xhtml'</p><p><a href="p_store.html#option_doctype-public">doctype-public</a> = '-//W3C//DTD XHTML 1.1//EN'</p><p><a href="p_store.html#option_doctype-system">doctype-system</a> = 'http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd'</p><p><a href="p_store.html#option_indent">indent</a> = if ($indent = 'true') then 'true' else 'false'</p><p><a href="p_store.html#option_href">href</a> = $chunk-file-uri</p></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_xslt.html">p:xslt</a></span> <span class="name" id="step_collect-file-uri">collect-file-uri</span></p></td><td><dl><dt>source</dt><dd>
            <p><a href="#step_store-chunks_port_current">current</a> on <a href="#step_store-chunks">store-chunks</a></p>
          </dd><dt>stylesheet</dt><dd>
            <p>p:document<a href="../xsl/collect-file-uri.xsl">../xsl/collect-file-uri.xsl</a></p>
          </dd></dl></td><td><p id="step_collect-file-uri_port_result">result</p></td><td></td></tr><tr class="local-end"><td colspan="3"><p class="names"><span class="type"><a href="p_sink.html">p:sink</a></span> <span class="name generated" id="step_d256e564">d256e564</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_collect-file-uri_port_result">result</a> on <a href="#step_collect-file-uri">collect-file-uri</a></p></dd></dl></td><td></td><td></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_add-attribute.html">p:add-attribute</a></span> <span class="name" id="step_patch-xml-base">patch-xml-base</span></p></td><td><dl><dt>source</dt><dd>
            <p><a href="#step_postprocessing_port_result">result</a> on <a href="#step_postprocessing">postprocessing</a></p>
          </dd></dl></td><td><p id="step_patch-xml-base_port_result">result</p></td><td><p><a href="p_add-attribute.html#option_attribute-name">attribute-name</a> = 'xml:base'</p><p><a href="p_add-attribute.html#option_match">match</a> = '/*'</p><p><a href="p_add-attribute.html#option_attribute-value">attribute-value</a> = $chunk-file-uri</p></td></tr><tr class="local-end"><td colspan="4"><p class="names"><span class="type"><a href="p_sink.html">p:sink</a></span> <span class="name generated" id="step_d256e578">d256e578</span></p></td><td><dl><dt>source</dt><dd></dd></dl></td><td></td><td></td></tr><tr class="foreach"><td rowspan="9"><p class="rotate" title="p:for-each">p:for-each <span class="name" id="step_signal-splitting-error">signal-splitting-error</span></p></td><td colspan="3"><p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">The presence of an orig.txt is an indicator that the split text differs from the original text.</p><p xmlns:cat="urn:oasis:names:tc:entity:xmlns:xml:catalog" xmlns:c="http://www.w3.org/ns/xproc-step" xmlns:tr="http://transpect.io">We’ll raise an error. We don’t do it immediately within the split step because we want to store the results
          first so that you can do forensics.</p></td><td id="step_signal-splitting-error_port_current">
          <p><a href="#step_split_port_secondary">secondary</a> on <a href="#step_split">split</a></p>
        </td><td></td><td></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_store.html">p:store</a></span> <span class="name" id="step_store-orig-txt">store-orig-txt</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_signal-splitting-error_port_current">current</a> on <a href="#step_signal-splitting-error">signal-splitting-error</a></p></dd></dl></td><td><p id="step_store-orig-txt_port_result">result</p></td><td><p><a href="p_store.html#option_method">method</a> = 'text'</p><p><a href="p_store.html#option_href">href</a> = base-uri()</p></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_identity.html">p:identity</a></span> <span class="name generated" id="step_d256e595">d256e595</span></p></td><td><dl><dt>source</dt><dd>
            <p><a href="#step_split_port_secondary">secondary</a> on <a href="#step_split">split</a></p>
          </dd></dl></td><td><p id="step_d256e595_port_result">result</p></td><td></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_store.html">p:store</a></span> <span class="name" id="step_store-chunks-txt">store-chunks-txt</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e595_port_result">result</a> on <a href="#step_d256e595">d256e595</a></p></dd></dl></td><td><p id="step_store-chunks-txt_port_result">result</p></td><td><p><a href="p_store.html#option_method">method</a> = 'text'</p><p><a href="p_store.html#option_href">href</a> = base-uri()</p></td></tr><tr class="foreach"><td rowspan="2"><p class="rotate" title="p:for-each">p:for-each <span class="name" id="step_store-debug">store-debug</span></p></td><td colspan="2"></td><td id="step_store-debug_port_current">
            <p><a href="#step_split_port_secondary">secondary</a> on <a href="#step_split">split</a></p>
          </td><td></td><td></td></tr><tr><td colspan="2"><p class="names"><span class="type"><a href="p_store.html">p:store</a></span> <span class="name generated" id="step_d256e616">d256e616</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_store-debug_port_current">current</a> on <a href="#step_store-debug">store-debug</a></p></dd></dl></td><td><p id="step_d256e616_port_result">result</p></td><td><p><a href="p_store.html#option_href">href</a> = base-uri()</p></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_add-attribute.html">p:add-attribute</a></span> <span class="name" id="step_orig-txt-url">orig-txt-url</span></p></td><td><dl><dt>source</dt><dd>
            <pre><code>
 &lt;p&gt;The after-split text differs from the pre-split text. This
   typically occurs when there is bare text content on the same level as headings. Please check your HTML
   input and/or its generation process. If debugging is switched on, you’ll find two files, &lt;a&gt;orig.txt&lt;/a&gt;
   and &lt;a&gt;chunks.txt&lt;/a&gt;, that you may diff line by line.&lt;/p&gt;

</code></pre>
          </dd></dl></td><td><p id="step_orig-txt-url_port_result">result</p></td><td><p><a href="p_add-attribute.html#option_match">match</a> = '/html:p/html:a[1]'</p><p><a href="p_add-attribute.html#option_attribute-name">attribute-name</a> = 'href'</p><p><a href="p_add-attribute.html#option_attribute-value">attribute-value</a> = base-uri()</p></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_add-attribute.html">p:add-attribute</a></span> <span class="name" id="step_chunks-txt-url">chunks-txt-url</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_orig-txt-url_port_result">result</a> on <a href="#step_orig-txt-url">orig-txt-url</a></p></dd></dl></td><td><p id="step_chunks-txt-url_port_result">result</p></td><td><p><a href="p_add-attribute.html#option_match">match</a> = '/html:p/html:a[2]'</p><p><a href="p_add-attribute.html#option_attribute-name">attribute-name</a> = 'href'</p><p><a href="p_add-attribute.html#option_attribute-value">attribute-value</a> = replace(base-uri(), 'orig\.txt$', 'chunks.txt')</p></td></tr><tr><td colspan="3"><p class="names"><span class="type"><a href="p_error.html">p:error</a></span> <span class="name" id="step_splitting-error">splitting-error</span></p></td><td><dl><dt>source</dt><dd>
            <p><a href="#step_chunks-txt-url_port_result">result</a> on <a href="#step_chunks-txt-url">chunks-txt-url</a></p>
          </dd></dl></td><td><p id="step_splitting-error_port_result">result</p></td><td><p><a href="p_error.html#option_code">code</a> = 'epub:SPLT01'</p></td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="p_wrap-sequence.html">p:wrap-sequence</a></span> <span class="name generated" id="step_d256e659">d256e659</span></p></td><td><dl><dt>source</dt><dd>
          <p><a href="#step_store-chunks_port_result">result</a> on <a href="#step_store-chunks">store-chunks</a></p>
        </dd></dl></td><td><p id="step_d256e659_port_result">result</p></td><td><p><a href="p_wrap-sequence.html#option_wrapper">wrapper</a> = 'document'</p><p><a href="p_wrap-sequence.html#option_wrapper-namespace">wrapper-namespace</a> = 'http://xmlcalabash.com/ns/extensions'</p><p><a href="p_wrap-sequence.html#option_wrapper-prefix">wrapper-prefix</a> = 'cx'</p></td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="p_add-attribute.html">p:add-attribute</a></span> <span class="name" id="step_wrap-chunks">wrap-chunks</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e659_port_result">result</a> on <a href="#step_d256e659">d256e659</a></p></dd></dl></td><td><p id="step_wrap-chunks_port_result">result</p></td><td><p><a href="p_add-attribute.html#option_match">match</a> = '/*'</p><p><a href="p_add-attribute.html#option_attribute-name">attribute-name</a> = 'name'</p><p><a href="p_add-attribute.html#option_attribute-value">attribute-value</a> = 'wrap-chunks'</p></td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="p_wrap-sequence.html">p:wrap-sequence</a></span> <span class="name generated" id="step_d256e669">d256e669</span></p></td><td><dl><dt>source</dt><dd>
          <p><a href="#step_store-chunks_port_files">files</a> on <a href="#step_store-chunks">store-chunks</a></p>
        </dd></dl></td><td><p id="step_d256e669_port_result">result</p></td><td><p><a href="p_wrap-sequence.html#option_wrapper">wrapper</a> = 'document'</p><p><a href="p_wrap-sequence.html#option_wrapper-namespace">wrapper-namespace</a> = 'http://xmlcalabash.com/ns/extensions'</p><p><a href="p_wrap-sequence.html#option_wrapper-prefix">wrapper-prefix</a> = 'cx'</p></td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="tr_store-debug.html">tr:store-debug</a></span> <span class="name" id="step_wrap-chunk-uris">wrap-chunk-uris</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e669_port_result">result</a> on <a href="#step_d256e669">d256e669</a></p></dd></dl></td><td><p id="step_wrap-chunk-uris_port_result">result</p></td><td><p><a href="tr_store-debug.html#option_pipeline-step">pipeline-step</a> = concat('epubtools/html-splitter/', $basename, '/result')</p><p><a href="tr_store-debug.html#option_active">active</a> = $debug</p><p><a href="tr_store-debug.html#option_base-uri">base-uri</a> = $debug-dir-uri</p></td></tr><tr class="catch"><td rowspan="7"><p class="rotate" title="p:catch">p:catch <span class="name" id="step_split-failed">split-failed</span></p></td><td colspan="4"></td><td><p id="step_split-failed_port_error">error</p></td><td></td><td></td></tr><tr><td colspan="4"><p class="names"><span class="type">p:variable</span> <span class="name" id="var_basename">basename</span></p></td><td><p><a href="#step_strip-leading-non-elements_port_result">result</a> on <a href="#step_strip-leading-non-elements">strip-leading-non-elements</a></p></td><td></td><td>replace($base-uri, '^(.*[/])+(.*?)(\.[\w.]+)$', '$2')</td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="tr_propagate-caught-error.html">tr:propagate-caught-error</a></span> <span class="name" id="step_propagate">propagate</span></p></td><td><dl><dt>source</dt><dd>
          <p><a href="#step_split-failed_port_error">error</a> on <a href="#step_split-failed">split-failed</a></p>
        </dd></dl></td><td><p id="step_propagate_port_result">result</p></td><td><p><a href="tr_propagate-caught-error.html#option_msg-file">msg-file</a> = 'splitter-error.txt'</p><p><a href="tr_propagate-caught-error.html#option_code">code</a> = 'epub:SPLT01'</p><p><a href="tr_propagate-caught-error.html#option_status-dir-uri">status-dir-uri</a> = concat($debug-dir-uri, '/status')</p></td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="tr_store-debug.html">tr:store-debug</a></span> <span class="name" id="step_store-error-message">store-error-message</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_propagate_port_result">result</a> on <a href="#step_propagate">propagate</a></p></dd></dl></td><td><p id="step_store-error-message_port_result">result</p></td><td><p><a href="tr_store-debug.html#option_pipeline-step">pipeline-step</a> = concat('epubtools/html-splitter/', $basename, '/ERROR_split')</p><p><a href="tr_store-debug.html#option_active">active</a> = $debug</p><p><a href="tr_store-debug.html#option_base-uri">base-uri</a> = $debug-dir-uri</p></td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="cx_message.html">cx:message</a></span> <span class="name generated" id="step_d256e739">d256e739</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_store-error-message_port_result">result</a> on <a href="#step_store-error-message">store-error-message</a></p></dd></dl></td><td><p id="step_d256e739_port_result">result</p></td><td><p><a href="cx_message.html#option_message">message</a> = '[ERROR] split failed with error message: ', .</p></td></tr><tr><td colspan="4"><p class="names"><span class="type"><a href="p_identity.html">p:identity</a></span> <span class="name" id="step_errors">errors</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e739_port_result">result</a> on <a href="#step_d256e739">d256e739</a></p></dd></dl></td><td><p id="step_errors_port_result">result</p></td><td></td></tr><tr class="local-end"><td colspan="4"><p class="names"><span class="type"><a href="p_sink.html">p:sink</a></span> <span class="name generated" id="step_d256e746">d256e746</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_errors_port_result">result</a> on <a href="#step_errors">errors</a></p></dd></dl></td><td></td><td></td></tr><tr><td colspan="6"><p class="names"><span class="type"><a href="p_add-attribute.html">p:add-attribute</a></span> <span class="name generated" id="step_d256e750">d256e750</span></p></td><td><dl><dt>source</dt><dd>
      <p><a href="#step_html-splitter-group_port_report">report</a> on <a href="#step_html-splitter-group">html-splitter-group</a></p>
    </dd></dl></td><td><p id="step_d256e750_port_result">result</p></td><td><p><a href="p_add-attribute.html#option_match">match</a> = '/*'</p><p><a href="p_add-attribute.html#option_attribute-name">attribute-name</a> = 'tr:step-name'</p><p><a href="p_add-attribute.html#option_attribute-value">attribute-value</a> = 'html-splitter'</p></td></tr><tr><td colspan="6"><p class="names"><span class="type"><a href="p_add-attribute.html">p:add-attribute</a></span> <span class="name" id="step_report">report</span></p></td><td><dl><dt>source</dt><dd><p><a href="#step_d256e750_port_result">result</a> on <a href="#step_d256e750">d256e750</a></p></dd></dl></td><td><p id="step_report_port_result">result</p></td><td><p><a href="p_add-attribute.html#option_match">match</a> = '/*'</p><p><a href="p_add-attribute.html#option_attribute-name">attribute-name</a> = 'tr:rule-family'</p><p><a href="p_add-attribute.html#option_attribute-value">attribute-value</a> = 'html-splitter'</p></td></tr></table></div><div class="interface block use"><h3 class="toggle"><a class="pointer">Used by</a></h3><ul><li><p class="nav" id="nav_epub_create-ops">declare-step <a href="epub_create-ops.html">epub:create-ops</a></p></li></ul></div></div></div></div></body></html>